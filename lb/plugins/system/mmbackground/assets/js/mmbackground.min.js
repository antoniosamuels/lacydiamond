/**
 * @version     $Id: mmbackground.min.js 541 2010-09-13 20:48:22Z martin $
 * @package     Joomla
 * @subpackage  System - mmBackground
 * @author      Martin Gray <author [at] mmPlugins.com>
 * @copyright   Copyright (C) 2009 mmPlugins | All rights reserved
 * @license     GNU/GPL v.2
 * @see         /plugins/system/mmbackground/LICENSE.php
 */
var wdgtBackground=new Class({bg:null,img:null,overlay:null,stage:null,width:0,height:0,imgWidth:0,imgHeight:0,atScreen:0,options:{transition:Fx.Transitions.Cubic.easeInOut,rotate:{active:true,interval:5000,transition:Fx.Transitions.Cubic.easeInOut,duration:2000},images:[],dimensions:[],background:{opacity:1,color:'#000000'},image:{opacity:0.5},overlay:{image:null,opacity:1,color:'#000000'},onInit:Class.empty,onAdjust:Class.empty,stretch:false,constrain_ratio:false,align:'center',vertical_align:'middle',bgRepeat:'no-repeat',bgPosition:'50% 0%'},initialize:function(stage,options){this.stage=stage;this.setOptions(options);this.bg=new Element('div',{'id':'mmBg','styles':{'zIndex':-5,'position':'absolute','backgroundColor':this.options.background.color,'opacity':this.options.background.opacity}});this.bg=this.bg.injectInside(document.body);if(this.options.stretch){this.img=new Element('img',{'id':'mmBgImage','styles':{'zIndex':-3,'position':'absolute','opacity':this.options.image.opacity},'src':this.options.images[0]});this.img.injectInside(document.body);this.img2=new Element('img',{'id':'mmBgImage2','styles':{'zIndex':-4,'position':'absolute','opacity':0},'src':this.options.images[1]});this.img2.injectInside(document.body);}else{this.img=new Element('div',{'id':'mmBgImage','styles':{'zIndex':-3,'position':'absolute','opacity':this.options.image.opacity,'background':'url('+this.options.images[0]+') '+this.options.bgPosition+' '+this.options.bgRepeat}});this.img.injectInside(document.body);this.img2=new Element('div',{'id':'mmBgImage2','styles':{'zIndex':-4,'position':'absolute','opacity':0,'background':'url('+this.options.images[1]+') '+this.options.bgPosition+' '+this.options.bgRepeat}});this.img2.injectInside(document.body);}
this.overlay=new Element('div',{'id':'mmBgOverlay','styles':{'zIndex':-2,'position':'absolute','background-color':this.options.overlay.color,'opacity':this.options.overlay.opacity}});if(this.options.overlay.image!=''){this.overlay.setStyles({'background':'url('+this.options.overlay.image+') '+this.options.overlay.color});}
this.overlay.injectInside(document.body);this.adjust();this._preload();if(this.options.rotate.active==true&&this.options.images.length>1)this.timer=this._autoRotate.periodical(this.options.rotate.interval,this);this.fireEvent('onInit');},adjust:function(){this.width=this.stage.stage.getSize().size.x;this.height=this.stage.stage.getSize().size.y;if(this.options.stretch&&this.options.constrain_ratio&&this.options.dimensions[this.atScreen]){this._constrainRatio(this.img,this.atScreen);}else{this.img.setStyles({height:this.height+'px',width:this.width+'px'});}
this.bg.setStyles({height:this.height+'px',width:this.width+'px'});this.img2.setStyles({height:this.height+'px',width:this.width+'px'});this.overlay.setStyles({height:this.height+'px',width:this.width+'px'});this.fireEvent('onAdjust');},_preload:function(){new Asset.images(this.options.images,{onComplete:function(){}});},_autoRotate:function()
{this._next();},_next:function(){var lastIndex=this.atScreen;this.atScreen+=1;if(this.atScreen>=this.options.images.length)this.atScreen=0;this._animate(this.atScreen,lastIndex);},_animate:function(a,b){if(this.options.stretch){if(this.options.constrain_ratio)this._constrainRatio(this.img2,a);this.img2.setProperty('src',this.options.images[a]);}else{this.img2.setStyle('background-image','url('+this.options.images[a]+')');}
this.img2.setStyle('display','block');var ani=new Fx.Style(this.img2,'opacity',{duration:this.options.rotate.duration,transition:this.options.rotate.transition});ani.start(this.options.image.opacity);var ani=new Fx.Style(this.img,'opacity',{duration:this.options.rotate.duration,transition:this.options.rotate.transition,onComplete:function(){if(this.options.constrain_ratio)this._constrainRatio(this.img,a);this.img.setStyle('opacity',this.options.image.opacity);if(this.options.stretch){this.img.setProperty('src',this.options.images[a]);}else{this.img.setStyle('background-image','url('+this.options.images[a]+')');}
this.img2.setStyle('display','none');this.img2.setStyle('opacity',0);}.bind(this)});ani.start(0);},_constrainRatio:function(img,idx){if(this.options.constrain_ratio&&this.options.dimensions[idx]){winRatio=this.width/this.height;if(winRatio<=this.options.dimensions[idx].ratio){this.imgHeight=this.height;this.imgWidth=(this.height*this.options.dimensions[idx].ratio).round();}else{this.imgWidth=this.width;this.imgHeight=(this.width/this.options.dimensions[idx].ratio).round();}
switch(this.options.vertical_align){case'middle':offsetY=(this.height-this.imgHeight)/2;img.setStyles({'width':this.imgWidth+'px','height':this.imgHeight+'px','top':offsetY+'px','bottom':'auto'});break;case'top':img.setStyles({'width':this.imgWidth+'px','height':this.imgHeight+'px','top':'0px','bottom':'auto'});break;case'bottom':img.setStyles({'width':this.imgWidth+'px','height':this.imgHeight+'px','bottom':'0px','top':'auto'});break;}
switch(this.options.align){case'center':offsetX=(this.width-this.imgWidth)/2;img.setStyles({'left':offsetY+'px','right':'auto'});break;case'left':img.setStyles({'left':'0px','right':'auto'});break;case'right':img.setStyles({'right':'0px','left':'auto'});break;}}}});wdgtBackground.implement(new Events,new Options);var wdgtWrapper=new Class({stage:null,options:{onInit:Class.empty,onAdjust:Class.empty},initialize:function(stage,options){this.stage=stage;this.setOptions(options);this.wrapper=$('mmWrapper');this.adjust();this.fireEvent('onInit');},adjust:function(){this.width=this.stage.stage.getSize().size.x;this.height=this.stage.stage.getSize().size.y;this.wrapper.setStyles({height:this.height+'px',width:this.width+'px'});this.fireEvent('onAdjust');}});wdgtWrapper.implement(new Events,new Options);